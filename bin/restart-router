#!/usr/bin/env ruby -Ku
# -*- coding: utf-8 -*-

$: << File.dirname(__FILE__) + '/lib'

require 'keychain'
require 'net/http'
require 'uri'


ROUTER_IP    = '192.168.0.1'
ROUTER_ADMIN = 'adm'
PASSWORD     = Keychain.get_password(ROUTER_IP, ROUTER_ADMIN, 'http')

req = Net::HTTP::Post.new('/index.cgi/mainte_reboot_com_set_set')
req.basic_auth ROUTER_ADMIN, Keychain.get_password(ROUTER_IP, ROUTER_ADMIN, 'http')
req.set_form_data({
  'submit' => 'mainte_reboot_com_set_set'
})

res = Net::HTTP.new(ROUTER_IP, 80).start {|http| http.request(req) }
case res
when Net::HTTPSuccess #, Net::HTTPRedirection
  # OK
  30.times { sleep 1 and print '.' }
  puts "\nOK"

else
  # NG
  puts "Check your network settings and try again."
  exit!
end

