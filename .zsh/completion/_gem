#compdef gem

_get_installed_gems() {
  installed_gems=(`gem list --no-versions`)
}

local -a _1st_arguments
_1st_arguments=(
  'install:install a gem'
  'uninstall:uninstall a gem'
  'list:gems list'
  'server:start a gem server'
)

local expl
local -a installed_gems

_arguments \
  '(-v --version)'{-v,--version}'[version information]' \
  '(-h --help)'{-h,--help}'[help]' \
  '*:: :->subcmds' && return 0

if (( CURRENT == 1 )); then
  _describe -t commands "gem subcommand" _1st_arguments
  return
fi

case "$words[1]" in
  uninstall|list)
    _get_installed_gems
    _wanted installed_gems expl 'all installed gems' compadd -a installed_gems ;;
esac
